# Kubernetes Installer

## Overview

This repository provides a streamlined approach to deploying a Kubernetes cluster using Ansible. It supports on-premises servers and, in the "Quick Start" section, provides an example using AWS EC2 instances for quick testing and development. 

Architecture:
![alt text](image.png)

# Quick Start
---

## Prerequisites
Tools Required:
~~~
- Terraform (for testing on AWS)
- Ansible
~~~


## Installation Steps
### Install VMs on AWS
Ensure AWS credentials are set in your environment:
~~~
export AWS_ACCESS_KEY_ID=<aws_access_key_id>
export AWS_SECRET_ACCESS_KEY=<aws_secret_access_key>
~~~

Use Terraform to provision EC2 instances(Ubuntu was tested in this example). The Terraform script will automatically populate the ansible/inventory file with the public IPs of the created instances.
~~~
git clone https://github.com/rasulkarimov/kubernetes-installer.git
cd kubernetes-installer/terraform
terraform init
terraform plan
terraform apply
~~~

### Prepare ansible for Kubernetes cluster installation
After running Terraform, check that the ansible/inventory file contains the IP addresses of the created instances:
~~~
cat ../ansible/inventory
~~~

Test SSH Access
Credentials for SSH access defined in ansible.cfg file. 
Confirm that you can connect to the instances using the SSH key generated by Terraform:
~~~
ssh -i kubernetes.key ubuntu@<public_ip>
exit
~~~

Run the Ansible playbook to install the Kubernetes cluster:
~~~
cd ../ansible
ansible-playbook site.yml
~~~

Check Node Status
Log in to the master node and verify that all nodes are up and ready:
~~~
ssh -i kubernetes.key ubuntu@<master_node_ip>
kubectl get nodes -o wide
~~~

Or use kubeconfig.cfg which is copied to local folder duriong kubernees installation process:
~~~
kubectl --kubeconfig=kubeconfig.cfg get nodes -o wide
~~~


## Destroy AWS EC2 Infrastructure
To tear down the testing environment on AWS, use the following command:
~~~
cd ../terraform
terraform destroy
~~~

### For On-Premises Servers
- **OS**: Ensure that servers are provisioned with distributions based on Debian or Red Hat. PXE (Preboot Execution Environment) can be configured in the data center to automate provisioning.
- **Network**: Ensure that the network interface is configured with a static IP address. Additional configurations can be applied using your scripts according to your specific requirements.
- **Load Balancer**: The Ansible roles are designed to check if a [loadbalancer] is defined in the inventory file. If provided, the HAProxy load balancer will be configured and used in Kubernetes bootstraping configuration; otherwise, Kubernetes will be deployed without a load balancer. Additionally, if "public_dns" is provided for the load balancer host, a test application will be deployed and exposed using this "public_dns".

The "kubernetes-installer" follows the official Kubernetes installation instructions. For troubleshooting and detailed setup procedures, refer to the official Kubernetes documentation: [Kubernetes Setup Docs](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/).